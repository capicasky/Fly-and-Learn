<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fly and Learn</title>

<style>
body {
  font-family: Arial, sans-serif;
  background-color: #A7C7E7;
  text-align: center;
  padding: 40px 15px;
  color: #2c3e50;
}

h1 {
  font-size: 48px;
  color: #1b4f72;
}

.plane {
  display: inline-block;
  animation: float 2.5s ease-in-out infinite;
}

@keyframes float {
  0% { transform: translateY(0); }
  50% { transform: translateY(-6px); }
  100% { transform: translateY(0); }
}

.metar-box {
  max-width: 420px;
  margin: 30px auto;
}

.control {
  width: 100%;
  padding: 12px;
  font-size: 14px;
  box-sizing: border-box;
  margin-bottom: 10px;
}

input.control {
  text-transform: uppercase;
}

button.control {
  background: #2e7d32;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

button.control.secondary {
  background: #455a64;
}

button.control:hover {
  opacity: 0.9;
}

.result-box {
  margin-top: 10px;
  background: #ffffff;
  padding: 12px;
  border-radius: 6px;
  text-align: left;
  font-family: monospace;
  white-space: pre-wrap;
  font-size: 14px;
}
</style>
</head>

<body>

<h1>Fly and Learn <span class="plane">✈️</span></h1>
<p>Aviation made simple.</p>
<p><strong>Capi Casky</strong></p>

<div class="metar-box">

  <!-- METAR / TAF BUTTON -->
  <button class="control" onclick="toggleMetar()">
    METAR / TAF
  </button>

  <!-- METAR MODULE -->
  <div id="metar-module" style="display:none; margin-top:15px;">
    <input id="icao" class="control" placeholder="Enter ICAO (e.g. MRPV)">

    <div id="metar-result" class="result-box">Waiting...</div>
    <div id="taf-result" class="result-box">Waiting...</div>

    <p style="font-size:12px; opacity:0.7;">
      For training and educational purposes only.
    </p>
  </div>

  <!-- WIND COMPONENT BUTTON -->
  <button class="control secondary" onclick="toggleWind()">
    Wind Component
  </button>

  <!-- WIND MODULE -->
  <div id="wind-module" style="display:none; margin-top:15px;">

    <input id="runway" class="control" placeholder="Runway heading (deg)">
    <input id="wind-dir" class="control" placeholder="Wind direction (deg)">
    <input id="wind-spd" class="control" placeholder="Wind speed (kt)">

    <div id="wind-result" class="result-box">
      Waiting...
    </div>

    <p style="font-size:12px; opacity:0.7;">
      For training and educational purposes only.
    </p>
  </div>

</div>

<script>
/* TOGGLE MODULES */
function toggleMetar() {
  const box = document.getElementById("metar-module");
  box.style.display = box.style.display === "none" ? "block" : "none";
}

function toggleWind() {
  const box = document.getElementById("wind-module");
  box.style.display = box.style.display === "none" ? "block" : "none";
}

/* ENTER KEY HANDLING */
document.addEventListener("keypress", function(e) {
  if (e.key === "Enter") {
    if (document.getElementById("metar-module").style.display === "block") {
      getWeather();
    }
    if (document.getElementById("wind-module").style.display === "block") {
      calcWind();
    }
  }
});

/* METAR / TAF */
function getWeather() {
  const icao = document.getElementById("icao").value.trim().toUpperCase();
  const metar = document.getElementById("metar-result");
  const taf = document.getElementById("taf-result");

  if (icao.length !== 4) {
    metar.textContent = "Invalid ICAO code";
    taf.textContent = "-";
    return;
  }

  metar.textContent = "Loading METAR...";
  taf.textContent = "Loading TAF...";

  fetch("https://api.allorigins.win/raw?url=" +
    encodeURIComponent(
      "https://aviationweather.gov/api/data/metar?ids=" + icao + "&format=raw"
    ))
    .then(r => r.text())
    .then(d => metar.textContent = d.trim() || "No METAR found");

  fetch("https://api.allorigins.win/raw?url=" +
    encodeURIComponent(
      "https://aviationweather.gov/api/data/taf?ids=" + icao + "&format=raw"
    ))
    .then(r => r.text())
    .then(d => taf.textContent = d.trim() || "No TAF found");
}

/* WIND COMPONENT */
function calcWind() {
  const rwy = Number(document.getElementById("runway").value);
  const wdir = Number(document.getElementById("wind-dir").value);
  const wspd = Number(document.getElementById("wind-spd").value);

  if (!rwy || !wdir || !wspd) {
    document.getElementById("wind-result").textContent =
      "Please enter all values.";
    return;
  }

  let angle = Math.abs(wdir - rwy);
  if (angle > 180) angle = 360 - angle;

  const rad = angle * Math.PI / 180;
  const cross = Math.round(wspd * Math.sin(rad));
  const head = Math.round(wspd * Math.cos(rad));

  document.getElementById("wind-result").textContent =
    Crosswind: ${Math.abs(cross)} kt\n +
    ${head >= 0 ? "Headwind" : "Tailwind"}: ${Math.abs(head)} kt;
}
</script>

</body>
</html>
