<script>
  function getWeather() {
    const icao = document.getElementById("icao").value.trim().toUpperCase();
    const metarBox = document.getElementById("metar-result");
    const tafBox = document.getElementById("taf-result");
    const notamBox = document.getElementById("notam-result");

    if (icao.length !== 4) {
      metarBox.textContent = "Please enter a valid ICAO code (4 letters)";
      tafBox.textContent = "—";
      notamBox.textContent = "—";
      return;
    }

    /* ================= METAR ================= */
    metarBox.textContent = "Loading METAR...";
    fetch(
      "https://api.allorigins.win/raw?url=" +
      encodeURIComponent(
        "https://aviationweather.gov/api/data/metar?ids=" +
        icao +
        "&format=raw"
      )
    )
      .then(r => r.text())
      .then(data => {
        metarBox.textContent = data.trim() || "No METAR found for " + icao;
      })
      .catch(() => {
        metarBox.textContent = "Error retrieving METAR";
      });

    /* ================= TAF ================= */
    tafBox.textContent = "Loading TAF...";
    fetch(
      "https://api.allorigins.win/raw?url=" +
      encodeURIComponent(
        "https://aviationweather.gov/api/data/taf?ids=" +
        icao +
        "&format=raw"
      )
    )
      .then(r => r.text())
      .then(data => {
        tafBox.textContent = data.trim() || "No TAF found for " + icao;
      })
      .catch(() => {
        tafBox.textContent = "Error retrieving TAF";
      });

    /* ================= NOTAMs ================= */
    notamBox.textContent = "Loading NOTAMs...";
    fetch(
      "https://api.allorigins.win/raw?url=" +
      encodeURIComponent(
        "https://aviationweather.gov/api/data/notam?ids=" + icao
      )
    )
      .then(r => r.text())
      .then(data => {
        notamBox.textContent = data.trim() || "No NOTAMs found for " + icao;
      })
      .catch(() => {
        notamBox.textContent = "Error retrieving NOTAMs";
      });
  }
</script>
